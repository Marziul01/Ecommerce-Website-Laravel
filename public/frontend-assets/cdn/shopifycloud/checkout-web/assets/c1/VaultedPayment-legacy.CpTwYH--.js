!function(){function e(e,n,t,o,a,r,i){try{var l=e[r](i),s=l.value}catch(e){return void t(e)}l.done?n(s):Promise.resolve(s).then(o,a)}System.register(["./app-legacy.Dbq41J9R.js"],(function(n,t){"use strict";var o,a,r,i,l,s,u,c,d,h,y,m,v,p,f,w,P,b,g,S,k,C,z,_,I,A,M,x,B,W,E,j,O,D;return{setters:[e=>{o=e.cd,a=e.cb,r=e.cc,i=e.c,l=e.g,s=e.br,u=e.ce,c=e.cf,d=e.a,h=e.L,y=e.ch,m=e.at,v=e.aW,p=e.jK,f=e.sB,w=e.hk,P=e.jp,b=e.ao,g=e.jq,S=e.q,k=e.jz,C=e.jA,z=e.bP,_=e.sC,I=e.sD,A=e.jB,M=e.sE,x=e.sF,B=e.cv,W=e.g6,E=e.cy,j=e.bg,O=e.sG,D=e.l}],execute:function(){var t=document.createElement("style");function U(){const e=o(),n=a(),t=r(),m=i(),v=l(),p=m("review.blocks.change_link_label"),{inMemoryAmazonPayParts:{hasPaymentSheetError:f}}=s();return u()?n.status!==c.Available?null:d(h,{onClick:()=>{try{n.sdk.buywithprime.changePaymentMethod({amazonPayOptions:{amazonCheckoutSessionId:t(),isDeclined:e}})}catch(o){f.value=!0,v.notify(new y(`Error on changing buyer payment method. Details: ${o}`,{cause:o}))}},children:p}):null}t.textContent=".oZdJX>*{display:flex;height:inherit;width:inherit}.oZdJX{overflow:hidden}\n/*$vite$:1*/",document.head.appendChild(t),n("P",T);class F extends Error{constructor(...e){var n,t,o;super(...e),n=this,o="PortableWalletsSandboxError",(t=function(e){var n=function(e){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var t=n.call(e,"string");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof n?n:n+""}(t="name"))in n?Object.defineProperty(n,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[t]=o}}const L={PortableWalletsPCIButton:"oZdJX"};function T({wallet:n,isSdkOnly:t=!1}){const{shop:o,errorLogger:a,source:r,environment:l}=m(),u=v(),{id:h}=o,{value:y}=p(),{countryCode:x,presentmentCurrency:B}=null!=y?y:{},W=f(n),E=null==W?void 0:W.configurationParams,j=w(null),{isScrimOpen:O,closePopupWindowsAndScrim:D}=P({endpoint:j,invokingWallet:n}),{inMemoryAmazonPayParts:{buttonStatus:U,sdkStatus:T}}=s(),q=i(),X=b(null),$=b(null),J=g(),N=S((({errorMessage:e})=>a.notify(new F(e))),[a]),Z=w(!1),G=S(function(){var o,a=(o=function*(e){T.value={status:c.Loading};const o=yield e.call.configure({configurationParams:E,buyerCountry:x,buyerCurrency:B,shopId:h,cartId:r.sourceId,onlySdk:t,service:l.services.portableWallets});(null==o?void 0:o.status)===k.Success?(T.value=function(e,n){return{status:c.Available,sdk:{buywithprime:{changePaymentMethod:({amazonPayOptions:t})=>{var o;if(!t.amazonCheckoutSessionId)throw new F("Missing amazonCheckoutSessionId");null===(o=n.value)||void 0===o||o.call.changePaymentMethod({wallet:e,changePaymentParams:{amazonCheckoutSessionId:t.amazonCheckoutSessionId,isDeclined:t.isDeclined}})},changeShippingAddress:({amazonPayOptions:t})=>{var o;if(!t.amazonCheckoutSessionId)throw new F("Missing amazonCheckoutSessionId");null===(o=n.value)||void 0===o||o.call.changeShippingAddress({wallet:e,changeShippingParams:{amazonCheckoutSessionId:t.amazonCheckoutSessionId}})},initCheckout:()=>{throw new F('Unexpected invocation of "initCheckout"')},renderButton:()=>{throw new F('Unexpected invocation of "renderButton"')}},Pay:{changePaymentMethod:()=>{throw new F('Unexpected invocation of AmazonPay "changePaymentMethod" in BWP flow')},changeShippingAddress:()=>{throw new F('Unexpected invocation of AmazonPay "changeShippingAddress" in BWP flow')},initCheckout:()=>{throw new F('Unexpected invocation of AmazonPay "initCheckout" in BWP flow')},renderButton:()=>{throw new F('Unexpected invocation of AmazonPay "renderButton" in BWP flow')}}}}}(n,j),t||(U.value={status:"rendered"},u.counter({name:"checkout_wallet_button_rendered",value:1,attributes:{wallet_name:n,status:"success",isPaymentMethodFlow:!1}}))):((null==o?void 0:o.status)===k.Error&&N({errorMessage:null==o?void 0:o.message}),T.value={status:c.Error},t||(U.value={status:"error"},u.counter({name:"checkout_wallet_button_rendered",value:1,attributes:{wallet_name:n,status:"error",isPaymentMethodFlow:!1}})))},function(){var n=this,t=arguments;return new Promise((function(a,r){var i=o.apply(n,t);function l(n){e(i,a,r,l,s,"next",n)}function s(n){e(i,a,r,l,s,"throw",n)}l(void 0)}))});return function(e){return a.apply(this,arguments)}}(),[E,x,h,B,r.sourceId,t,n,N,T,U,j,l,u]);Z.value&&null!=y&&y.countryCode&&null!=y&&y.presentmentCurrency&&j.value&&(Z.value=!1,G(j.value));const H=C(),K=z((()=>({clicked:e=>{var n,t,o;O.value=!0,J($),e&&(n=e.skus,t=e.apiClientId,null!==(o=window.Shopify)&&void 0!==o&&null!==(o=o.analytics)&&void 0!==o&&o.publish&&(window.Shopify.analytics.publish(`shopify:app:pixels:load:${t}`,{},{sendTo:"PIXEL-LOADER"}),window.Shopify.analytics.publish("bwp_checkout_widget_click",{skus:n},{sendTo:t})))},closed:()=>O.value=!1,redirect:({redirectUrl:e,requestPayload:n})=>{try{if(n){if(!X.current)return void a.notify(new _("Form container not found",{groupingHash:"AmazonPaySandboxError::PortableWalletsPCIButton::FormContainerNotFound"}));I({formContainer:X.current,url:e,requestPayload:n}).submit()}else window.location.assign(e)}catch(t){a.notify(t)}},reportError:N,telemetry:H})),[O,N,a,J,H]);return d("div",{className:L.PortableWalletsPCIButton,children:[d("div",{ref:X,style:{display:"none"}}),d(A,{wallet:n,onConnect:e=>{j.value=e,Z.value=!0},onTerminate:()=>j.value=null,hostMethods:K,isSdkOnly:t,ref:$}),d(M,{isOpen:O.value,walletName:q("brand.buy_with_prime"),handleClose:D})]})}const q=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const e=i(),{brand:n,descriptor:t}=x(),o=B(),a=!t||!o;return d(D,{children:[d(T,{wallet:W.BuyWithPrime,isSdkOnly:!0}),d(E,{id:"buyWithPrimePayDetails",label:e("payment.payment_method"),summary:a?d(j,{}):d(O,{brand:n,descriptor:t}),action:d(U,{})})]})}},Symbol.toStringTag,{value:"Module"}));n("V",q)}}}))}();
